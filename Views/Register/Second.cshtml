@model RegisterVM

@await Html.PartialAsync("_HeaderPartial", new HeaderModel{ Text = "İşletme Bilgileri", ArrowLink = "/Register/First" })

<form action="/Register/Second" method="post" class="px-4">
    <div class="w-full min-h-[calc(100vh-3.8rem)] flex flex-col gap-4 items-center justify-around">
        
            <div class="w-full h-full">
                <h1 class="text-[1.375rem] font-bold text-appText">İşletme Bilgileri</h1>
                <div>
                    <label for="BusinessName" class="text-appStroke text-xs font-inter font-normal">İşletme Adı</label>
                    <input class="bg-appBgMain border-b-2 text-[1rem] border-gray-300 focus:outline-none focus:border-appPrimary w-full"
                        asp-for="Business.BusinessName" type="text" placeholder="Esnafa Gelir ltd.">
                    <span class="text-appWarning text-sm" asp-validation-for="Business.BusinessName"></span>
                </div>
                <div>
                <label for="SelectedBusinessTypeId" class="text-appStroke text-xs font-inter font-normal">İşletme Türü</label>
                @Html.DropDownListFor(
                         s => s.SelectedBusinessTypeId,
                         new SelectList(Model.BusinessTypes, "BusinessTypeId", "BusinessTypeName"),
                         "Seçiniz",
                         new {@class = "border-b-2 text-[1rem] bg-appBgMain border-gray-300 focus:outline-none focus:border-appPrimary w-full py-2" }
                         )
                         <span class="text-appWarning text-sm" asp-validation-for="SelectedBusinessTypeId"></span>
                </div>
            </div>

            <div class="w-full h-full">
                <h1 class="text-[1.375rem] font-bold text-appText">Adres Bilgileri</h1>
                
                <label for="SelectedCityId" class="text-appStroke text-xs font-inter font-normal">İl</label>
                @Html.DropDownListFor(
                    s=> s.SelectedCityId,
                    new SelectList(Model.Cities, "CityId", "CityName"),
                    "Seçiniz",
                    new {
                        @class = "border-b-2 text-[1rem] bg-appBgMain border-gray-300 focus:outline-none focus:border-appPrimary w-full py-2",
                        id= "cityDropdown" 
                        }
                    )
                <span class="text-appWarning text-sm" asp-validation-for="SelectedCityId"></span>
                
                <label for="SelectedDisrictId" class="text-appStroke text-xs font-inter font-normal">İlçe</label>
                @Html.DropDownListFor(
                    s=> s.SelectedDisrictId,
                    new SelectList(Model.Districts, "DisrictId", "DisrictName"),
                    "Seçiniz",
                    new {
                        @class = "border-b-2 text-[1rem] bg-appBgMain border-gray-300 focus:outline-none focus:border-appPrimary w-full py-2",
                        id = "districtDropdown" 
                        }
                    )
                <span class="text-appWarning text-sm" asp-validation-for="SelectedDisrictId"></span>
                
                <label asp-for="Business.Address" class="text-appStroke text-xs font-inter font-normal">Adress</label>
                <textarea class="border-b-2 text-[1rem] bg-appBgMain border-gray-300 focus:outline-none focus:border-appPrimary w-full py-2" asp-for="Business.Address" placeholder="Açık adresi giriniz."></textarea>
            </div>
            <div class="w-full h-full flex flex-col items-center justify-center gap-3">
            <a  href="/Home/Index">Belki daha sonra</a>
        @await Html.PartialAsync("_ButtonPartial", new ButtonModel{ Text = "Kaydet", IsSubmit = true })
            </div>
    </div>
</form>

<script>
    document.getElementById("cityDropdown").addEventListener("change", function () {
        const cityId = this.value
        const districtDropdown = document.getElementById("districtDropdown")

        if (!cityId) {
            districtDropdown.innerHTML = '<option value="">Önce Şehir Seçiniz</option>';
            return
        }

        fetch(`/Register/GetDistrictsByCityId?cityId=${cityId}`)
            .then(response => response.json())
            .then(data => {
                
                districtDropdown.innerHTML = '<option value="">Seçiniz</option>'
                data.forEach(district => {
                    const option = document.createElement("option")
                    option.value = district.DistrictId
                    option.textContent = district.DistrictName
                    districtDropdown.appendChild(option)
                });
            })
            .catch(error => console.error("Hata:", error))
    });
</script>
